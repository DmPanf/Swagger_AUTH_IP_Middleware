## Client IP

Для определения IP-адреса пользователя при использовании Swagger UI в FastAPI, вы можете получить IP из объекта запроса Request, который предоставляется FastAPI. IP-адрес можно извлечь из заголовков запроса.

Вот пример функции, которая извлекает IP-адрес из запроса:

```python
from fastapi import FastAPI, Request, Depends

app = FastAPI()

def get_client_ip(request: Request):
    if "x-forwarded-for" in request.headers:
        # В случае использования прокси, таких как Nginx
        ip = request.headers["x-forwarded-for"]
        ip = ip.split(",")[0]
    else:
        ip = request.client.host
    return ip

@app.get("/")
async def read_root(request: Request):
    client_ip = get_client_ip(request)
    return {"client_ip": client_ip}

```

Этот код сначала проверяет наличие заголовка X-Forwarded-For, который часто используется прокси-серверами (такими как Nginx или load balancers), для передачи реального IP-адреса клиента.
Если заголовка нет, используется request.client.host.

## Telegram-Bot

При обращении к вашему FastAPI серверу через Telegram бота, ситуация с IP-адресами будет немного отличаться от прямых HTTP-запросов от клиентов. Telegram боты взаимодействуют с вашим API через серверы Telegram, а не напрямую от пользователя. Это означает, что IP-адрес, который вы увидите в запросах от бота Telegram, будет принадлежать серверу Telegram, а не конечному пользователю бота.

Если ваша цель — получить IP-адрес конечного пользователя Telegram бота, то это невозможно через обычное API-взаимодействие, поскольку:

1. **Анонимность**: Telegram защищает анонимность своих пользователей и не передает IP-адреса или другую подобную информацию через ботов.
2. **Прокси-сервера и маршрутизация**: Запросы от ботов проходят через серверы Telegram, которые могут находиться в разных географических локациях.

В контексте безопасности и аудита, вы можете регистрировать IP-адреса, с которых приходят запросы, но будьте готовы к тому, что это будут IP-адреса серверов Telegram. В случае с FastAPI, это можно сделать, используя `request.client.host`, как описано в предыдущем ответе. 

Если вам нужно отслеживать активность конкретных пользователей бота, рекомендуется использовать уникальные идентификаторы пользователя в Telegram (например, `chat_id`), а не IP-адреса.
